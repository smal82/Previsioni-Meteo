name: ğŸ” Code Quality

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  quality:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout del codice
      uses: actions/checkout@v3
    
    - name: ğŸ˜ Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '7.4'
    
    - name: ğŸ“Š Conta linee di codice
      run: |
        echo "ğŸ“ˆ Statistiche del progetto:"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo "ğŸ“„ File PHP: $(find . -name '*.php' | wc -l)"
        echo "ğŸ“„ File JS: $(find . -name '*.js' | wc -l)"
        echo "ğŸ“„ File CSS: $(find . -name '*.css' | wc -l)"
        echo "ğŸ“ Linee PHP: $(find . -name '*.php' -exec cat {} \; | wc -l)"
        echo "ğŸ“ Linee JS: $(find . -name '*.js' -exec cat {} \; | wc -l)"
        echo "ğŸ“ Linee CSS: $(find . -name '*.css' -exec cat {} \; | wc -l)"
    
    - name: ğŸ” Verifica errori comuni
      run: |
        echo "ğŸ” Controllo errori comuni..."
        
        # Verifica echo non chiusi
        if grep -r "echo.*[^;]$" --include="*.php" .; then
          echo "âš ï¸  Trovati echo senza punto e virgola"
        fi
        
        # Verifica var_dump rimasti
        if grep -r "var_dump\|print_r" --include="*.php" .; then
          echo "âš ï¸  Trovati var_dump/print_r (rimuovere prima del deploy)"
        fi
        
        echo "âœ… Controlli completati!"
    
    - name: ğŸ“¦ Dimensione progetto
      run: |
        SIZE=$(du -sh . | cut -f1)
        echo "ğŸ“¦ Dimensione totale: $SIZE"
