name: PHP CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout del codice
      uses: actions/checkout@v3
    
    - name: ðŸ˜ Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '7.4'
        extensions: json, mbstring
    
    - name: âœ… Verifica sintassi PHP
      run: |
        find . -name "*.php" -exec php -l {} \;
    
    - name: ðŸ“ Verifica file richiesti
      run: |
        test -f config.php || exit 1
        test -f index.php || exit 1
        test -f installer.php || exit 1
        test -f previsioni.php || exit 1
        test -f save-city.php || exit 1
        test -f delete-city.php || exit 1
        echo "âœ… Tutti i file richiesti sono presenti"
    
    - name: ðŸ” Verifica permessi scrittura
      run: |
        touch sites.json
        echo '{}' > sites.json
        test -w sites.json && echo "âœ… sites.json scrivibile" || exit 1
    
    - name: ðŸŽ‰ Test completati
      run: echo "âœ… Tutti i test sono passati!"
